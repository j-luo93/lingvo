

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.layers module &mdash; lingvo  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.layers_with_attention module" href="lingvo.core.layers_with_attention.html" />
    <link rel="prev" title="lingvo.core.input_generator_helper module" href="lingvo.core.input_generator_helper.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.layers module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.layers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.layers">
<span id="lingvo-core-layers-module"></span><h1>lingvo.core.layers module<a class="headerlink" href="#module-lingvo.core.layers" title="Permalink to this headline">¶</a></h1>
<p>Common layers.</p>
<dl class="function">
<dt id="lingvo.core.layers.FPropDtype">
<code class="descclassname">lingvo.core.layers.</code><code class="descname">FPropDtype</code><span class="sig-paren">(</span><em>params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#FPropDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.FPropDtype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.IdentityLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">IdentityLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#IdentityLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.IdentityLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Identity layer, adds name and propagates its input.</p>
<dl class="method">
<dt id="lingvo.core.layers.IdentityLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#IdentityLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.IdentityLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Identity mapping.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor.  Shaped […, input_dim].</li>
<li><strong>*args</strong> – Arguments to be ignored.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Tensor with the same shape and type of inputs.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.BatchNormLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">BatchNormLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#BatchNormLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.BatchNormLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Batch normalization layer.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.BatchNormLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#BatchNormLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.BatchNormLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="lingvo.core.layers.BatchNormLayer._Moments">
<em class="property">static </em><code class="descname">_Moments</code><span class="sig-paren">(</span><em>inputs</em>, <em>mask</em>, <em>enable_cross_replica_sum_on_tpu=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#BatchNormLayer._Moments"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.BatchNormLayer._Moments" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes mean and variance over the valid data points in inputs.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.BatchNormLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>paddings=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#BatchNormLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.BatchNormLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply batch normalization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor.  Shaped […, dim].</li>
<li><strong>paddings</strong> – The paddings tensor.  Shaped […, 1], with the same rank as
the input tensor.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Output after applying batch normalization, with the same shape as
‘inputs’.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="lingvo.core.layers.BatchNormLayer.FPropMeta">
<em class="property">classmethod </em><code class="descname">FPropMeta</code><span class="sig-paren">(</span><em>p</em>, <em>inputs</em>, <em>padding=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#BatchNormLayer.FPropMeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.BatchNormLayer.FPropMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns metadata about the <a class="reference internal" href="#lingvo.core.layers.BatchNormLayer.FProp" title="lingvo.core.layers.BatchNormLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> computation for this layer.</p>
<p><strong>Experimental feature.</strong>
Don’t use or depend on it without consulting Lingvo authors.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">SomeComplexLayer</span><span class="o">.</span><span class="n">Params</span><span class="p">()</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">cls</span><span class="o">.</span><span class="n">FPropMeta</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorShape</span><span class="p">([</span><span class="mi">128</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">32</span><span class="p">]))</span>
</pre></div>
</div>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">meta.flops</span></code> gives an estimate count of floating point operations done by
one <a class="reference internal" href="#lingvo.core.layers.BatchNormLayer.FProp" title="lingvo.core.layers.BatchNormLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> given an input tensor of shape [128, 20, 50, 32].
<code class="xref py py-obj docutils literal notranslate"><span class="pre">meta.out_shapes</span></code> is a tuple of tensor shapes, which tells you what shape
of tensors this layer will return.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>params</strong> – The param of a layer of this layer type.</li>
<li><strong>*args</strong> – Corresponds to FProp with Tensors replaced by <code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorShape</span></code>.</li>
<li><strong>**kwargs</strong> – Corresponds to FProp with Tensors replaced by <code class="xref py py-obj docutils literal notranslate"><span class="pre">TensorShape</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with</p>
<ul class="simple">
<li>flops - The estimated number of floating point operations incurred by
this fprop.</li>
<li>out_shapes - A tuple of <code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.TensorShape</span></code>. I.e., <code class="xref py py-obj docutils literal notranslate"><span class="pre">out_shapes[i]</span></code>
represents the shape of the <code class="xref py py-obj docutils literal notranslate"><span class="pre">i</span></code>-th returned tensor of the fprop.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="lingvo.core.layers._ComputeOutputPadding">
<code class="descclassname">lingvo.core.layers.</code><code class="descname">_ComputeOutputPadding</code><span class="sig-paren">(</span><em>in_padding</em>, <em>stride</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#_ComputeOutputPadding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers._ComputeOutputPadding" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes paddings for convolution and pooling output.</p>
<p>Let the stride on the time axis be ts and the input sequence length be
s_len, the output sequence length is s_len / ts. out_padding[i] == 1 iff any
of in_padding[ts * i], …, in_padding[ts * (i + 1) - 1] is 1.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>in_padding</strong> – The paddings tensor. It is expected to be of shape [batch,
time].</li>
<li><strong>stride</strong> – The time-stride between adjacent windows.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">out_padding, The new padding tensor of size [batch, ceil(time / stride)].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.ConvLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">ConvLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Convolution layer, with optional batch-normalization and activation.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.ConvLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.ConvLayer.OutShape">
<code class="descname">OutShape</code><span class="sig-paren">(</span><em>in_shape</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvLayer.OutShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvLayer.OutShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the output shape given the input shape.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.ConvLayer._ApplyConv">
<code class="descname">_ApplyConv</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvLayer._ApplyConv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvLayer._ApplyConv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.ConvLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>paddings=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply convolution to inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor. It is expected to be of shape [batch,
time, frequency, channel]. The time dimension corresponds to
the height dimension as in images and the frequency
dimension corresponds to the width dimension as in images.</li>
<li><strong>paddings</strong> – The paddings tensor. If None, the inputs have no
paddings in the sense of sequence training (e.g., in CNN
models). Otherwise, it is expected to be of shape [batch,
time].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">outputs, out_paddings pair.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.ProjectionLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">ProjectionLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ProjectionLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ProjectionLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.quant_utils.html#lingvo.core.quant_utils.QuantizableLayer" title="lingvo.core.quant_utils.QuantizableLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.quant_utils.QuantizableLayer</span></code></a></p>
<p>Projection layer, with batch normalization and relu activation.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.ProjectionLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ProjectionLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ProjectionLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.ProjectionLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>paddings=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ProjectionLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ProjectionLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply projection to inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor.  Shaped […, input_dim].</li>
<li><strong>paddings</strong> – The paddings tensor.  Shaped […, 1], where all but the last
dimension match.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Output after applying projection, and optionally batch normalization and
relu non-linearity.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.ProjectionLayer._ApplyAffineTransformation">
<code class="descname">_ApplyAffineTransformation</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ProjectionLayer._ApplyAffineTransformation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ProjectionLayer._ApplyAffineTransformation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.FCLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">FCLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#FCLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.FCLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.layers.ProjectionLayer" title="lingvo.core.layers.ProjectionLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.layers.ProjectionLayer</span></code></a></p>
<p>Fully-connected layer (matmul + bias + optional activation).</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.FCLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#FCLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.FCLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.PoolingLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">PoolingLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PoolingLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PoolingLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Pooling layer, by default performs max-pooling.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.PoolingLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PoolingLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PoolingLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.PoolingLayer.OutShape">
<code class="descname">OutShape</code><span class="sig-paren">(</span><em>in_shape</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PoolingLayer.OutShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PoolingLayer.OutShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the output shape given the input shape.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.PoolingLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>paddings=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PoolingLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PoolingLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply pooling to inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor. It is expected to be of shape [batch, time,
frequency, channel]. The time dimension corresponds to the height
dimension as in images and the frequency dimension corresponds to the
width dimension as in images.</li>
<li><strong>paddings</strong> – The paddings tensor. It is expected to be of shape [batch,
time]. Defaults to None, which means there no paddings.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">outputs, out_paddings pair.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.EmbeddingLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">EmbeddingLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#EmbeddingLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Embedding layer, with batch normalization and relu activation.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.EmbeddingLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#EmbeddingLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.layers.EmbeddingLayer.MIN_PARAMS_PER_SHARD">
<code class="descname">MIN_PARAMS_PER_SHARD</code><em class="property"> = 262144</em><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer.MIN_PARAMS_PER_SHARD" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="lingvo.core.layers.EmbeddingLayer.vars">
<code class="descname">vars</code><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer.vars" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="lingvo.core.layers.EmbeddingLayer.theta">
<code class="descname">theta</code><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer.theta" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.EmbeddingLayer.EmbLookupDefaultTheta">
<code class="descname">EmbLookupDefaultTheta</code><span class="sig-paren">(</span><em>ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#EmbeddingLayer.EmbLookupDefaultTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer.EmbLookupDefaultTheta" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.EmbeddingLayer.EmbLookup">
<code class="descname">EmbLookup</code><span class="sig-paren">(</span><em>theta</em>, <em>ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#EmbeddingLayer.EmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.EmbeddingLayer.EmbLookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks up embedding vectors for ids.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – Named tuple with the weight matrix for the embedding.</li>
<li><strong>ids</strong> – A rank-N int32 tensor.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A rank-(N+1) params.dtype tensor.
embs[indices, :] is the embedding vector for ids[indices].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.SimpleEmbeddingLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">SimpleEmbeddingLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleEmbeddingLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleEmbeddingLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>An embedding layer that is simple to compile (by XLA and Toco).</p>
<p>The params use_matmul and use_gather control how the lookup is performed.
If neither is True, then a loop is used to compute the embedding.</p>
<p>This layer is “simple” in comparison to ‘EmbeddingLayer’ in that it does
not shard the embeddings.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.SimpleEmbeddingLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleEmbeddingLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleEmbeddingLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleEmbeddingLayer.EmbLookupDefaultTheta">
<code class="descname">EmbLookupDefaultTheta</code><span class="sig-paren">(</span><em>ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleEmbeddingLayer.EmbLookupDefaultTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleEmbeddingLayer.EmbLookupDefaultTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Lookups embedding vectors for ids.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleEmbeddingLayer.EmbLookup">
<code class="descname">EmbLookup</code><span class="sig-paren">(</span><em>theta</em>, <em>ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleEmbeddingLayer.EmbLookup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleEmbeddingLayer.EmbLookup" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleEmbeddingLayer.EmbLookupDefaultThetaOnCpu">
<code class="descname">EmbLookupDefaultThetaOnCpu</code><span class="sig-paren">(</span><em>ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleEmbeddingLayer.EmbLookupDefaultThetaOnCpu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleEmbeddingLayer.EmbLookupDefaultThetaOnCpu" title="Permalink to this definition">¶</a></dt>
<dd><p>A faster path for CPU inference than the default gather.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleEmbeddingLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleEmbeddingLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleEmbeddingLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Lookups embedding vectors for ids.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – Named tuple collection of weights for the layer.</li>
<li><strong>ids</strong> – A rank-N int32 tensor.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A rank-(N+1) params.dtype tensor.
embs[indices, :] is the embedding vector for ids[indices].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.PositionalEmbeddingLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">PositionalEmbeddingLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PositionalEmbeddingLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PositionalEmbeddingLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Generates sinusoidals with respect to the position in time and dimension.</p>
<p>Implements the positional embedding layer from ‘Attention is All You Need’,
the Transformer Network.</p>
<p>Code and comments are adapted from tensor2tensor/layers/common_attention.py</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.PositionalEmbeddingLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PositionalEmbeddingLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PositionalEmbeddingLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.PositionalEmbeddingLayer._PosEmbeddingsFromPositions">
<code class="descname">_PosEmbeddingsFromPositions</code><span class="sig-paren">(</span><em>theta</em>, <em>position</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PositionalEmbeddingLayer._PosEmbeddingsFromPositions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PositionalEmbeddingLayer._PosEmbeddingsFromPositions" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the positional embeddings given the position tensor.</p>
<p>Factors out the common code from FProp and FPropWithPosition. Returns
positional embeddings corresponding to the input position tensor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>position</strong> – Position tensor of dtype float and shape [bs, seq_length] to
generate positional embeddings.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Tensor of shape [bs, seq_length, embedding_dim].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.PositionalEmbeddingLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>seq_length</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PositionalEmbeddingLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PositionalEmbeddingLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a Tensor of sinusoids with different frequencies.</p>
<p>Each channel (dimension) of the generated positionanl embedding Tensor
corresponds to a sinusoid of different frequency and phase.</p>
<p>This allows attention to learn to use absolute and relative positions.
Timing signals should be added to some precursors of both the query and the
memory inputs to attention.</p>
<p>The use of relative position is possible because sin(x+y) and cos(x+y) can
be experessed in terms of y, sin(x) and cos(x).</p>
<p>In particular, we use a geometric sequence of timescales starting with
min_timescale and ending with max_timescale.  The number of different
timescales is equal to channels (dimension) / 2. For each timescale, we
generate the two sinusoidal signals sin(timestep/timescale) and
cos(timestep/timescale).  All of these sinusoids are concatenated in
the channels dimension.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>seq_length</strong> – Sequence length of the embeddings to be generated</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Tensor of shape [seq_length, embedding_dim].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.PositionalEmbeddingLayer.FPropWithPosition">
<code class="descname">FPropWithPosition</code><span class="sig-paren">(</span><em>theta</em>, <em>position_tensor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#PositionalEmbeddingLayer.FPropWithPosition"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.PositionalEmbeddingLayer.FPropWithPosition" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a Tensor of sinusoids with different frequencies.</p>
<p>Uses the provided position tensor to generate positional embeddings. Refer
to FProp description for details of sinusoidal positional embeddings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>position_tensor</strong> – Position tensor of shape [bs, seq_length] to generate
positional embeddings.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Tensor of shape [bs, seq_length, embedding_dim].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.SoftmaxLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">SoftmaxLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SoftmaxLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SoftmaxLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.quant_utils.html#lingvo.core.quant_utils.QuantizableLayer" title="lingvo.core.quant_utils.QuantizableLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.quant_utils.QuantizableLayer</span></code></a></p>
<p>Base class for softmax layers.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.SoftmaxLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SoftmaxLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SoftmaxLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Params for SoftmaxLayer.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SoftmaxLayer.Logits">
<code class="descname">Logits</code><span class="sig-paren">(</span><em>**unused</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SoftmaxLayer.Logits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SoftmaxLayer.Logits" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the logits computed before the softmax.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SoftmaxLayer.XentLoss">
<code class="descname">XentLoss</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SoftmaxLayer.XentLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SoftmaxLayer.XentLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes cross entropy.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SoftmaxLayer._FProp2D">
<code class="descname">_FProp2D</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>class_weights</em>, <em>class_ids=None</em>, <em>class_probabilities=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SoftmaxLayer._FProp2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SoftmaxLayer._FProp2D" title="Permalink to this definition">¶</a></dt>
<dd><p>Specialized FProp for matrix inputs.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SoftmaxLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>class_weights</em>, <em>class_ids=None</em>, <em>class_probabilities=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SoftmaxLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SoftmaxLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes logit, cross entropy etc.</p>
<p>This function can both work with class_ids, or probability distributions
over classes. Exactly one of class_ids or class_probabilities must be
provided.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – a list of a single tensor, or a single tensor with the shape
[…, input_dim].</li>
<li><strong>class_weights</strong> – a tensor with shape […] containing the weights
for each target word.</li>
<li><strong>class_ids</strong> – a tensor with shape […, 1] of int32 dtype containing the
target class labels.</li>
<li><strong>class_probabilities</strong> – a tensor with shape […, num_classes] of
float values indicating class-membership probabilities.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> containing the following fields</p>
<ul class="simple">
<li>logits: with shape […, num_classes]. Unnormalized softmax’s logits.</li>
<li>per_example_argmax: with shape […]. argmax of i-th example.</li>
<li>per_example_xent: with shape […]. Cross entropy between i-th example’s
prediction and its label.</li>
<li>per_example_weight: with shape […]. class_weights casted to
this layer’s dtype.</li>
<li>total_xent: A scalar. The sum of per_example_weight * per_example_xent.</li>
<li>total_weight: A scalar. The sum of per_example_weight.</li>
<li>avg_xent: A scalar. total_loss / total_weight.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.SimpleFullSoftmax">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">SimpleFullSoftmax</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.layers.SoftmaxLayer" title="lingvo.core.layers.SoftmaxLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.layers.SoftmaxLayer</span></code></a></p>
<p>A somewhat simple softmax layer.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.SimpleFullSoftmax.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Params for SimpleFullSoftmax.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleFullSoftmax._GetInputs">
<code class="descname">_GetInputs</code><span class="sig-paren">(</span><em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax._GetInputs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax._GetInputs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleFullSoftmax._ConcatWeights">
<code class="descname">_ConcatWeights</code><span class="sig-paren">(</span><em>theta</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax._ConcatWeights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax._ConcatWeights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleFullSoftmax._LogitsUsingConcatenatedWeights">
<code class="descname">_LogitsUsingConcatenatedWeights</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax._LogitsUsingConcatenatedWeights"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax._LogitsUsingConcatenatedWeights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleFullSoftmax.Logits">
<code class="descname">Logits</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax.Logits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax.Logits" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the logits computed before the softmax.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – a list of a single tensor, or a single tensor with the shape
[N, input_dim].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">logits [batch, num_classes]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleFullSoftmax._XentLossByChunk">
<code class="descname">_XentLossByChunk</code><span class="sig-paren">(</span><em>theta</em>, <em>activation</em>, <em>class_ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax._XentLossByChunk"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax._XentLossByChunk" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes per-example xent loss between activation and class_ids.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.SimpleFullSoftmax._FProp2D">
<code class="descname">_FProp2D</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>class_weights</em>, <em>class_ids=None</em>, <em>class_probabilities=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#SimpleFullSoftmax._FProp2D"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.SimpleFullSoftmax._FProp2D" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes xent loss and log-prob logit.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.FeedForwardNet">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">FeedForwardNet</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#FeedForwardNet"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.FeedForwardNet" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>A simple multiple layer feedforward network.</p>
<p>This class represents a stack of fully connected feedforward network. Each
layer in the network can be configured for whether or not to have batch-norm
applied to its output, its activation function, whether or not to apply
dropout to post-activation output.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.FeedForwardNet.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#FeedForwardNet.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.FeedForwardNet.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.layers.FeedForwardNet._SKIP_CONNECTION_TYPES">
<code class="descname">_SKIP_CONNECTION_TYPES</code><em class="property"> = ('ResNet', 'DenseNet')</em><a class="headerlink" href="#lingvo.core.layers.FeedForwardNet._SKIP_CONNECTION_TYPES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.FeedForwardNet.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>paddings=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#FeedForwardNet.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.FeedForwardNet.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation.</p>
<p>The central interface that subclasses should implement. The caller
calls <a class="reference internal" href="#lingvo.core.layers.FeedForwardNet.FProp" title="lingvo.core.layers.FeedForwardNet.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp</span></code></a> with a <code class="xref py py-obj docutils literal notranslate"><span class="pre">theta</span></code> dictionary. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">InstanceOfASubClassOfFoo</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The implementation of <a class="reference internal" href="#lingvo.core.layers.FeedForwardNet.FProp" title="lingvo.core.layers.FeedForwardNet.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FProp()</span></code></a> computes a function given
the theta and the inputs. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">a0</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">softmax</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">softmax</span><span class="p">,</span> <span class="n">a0</span><span class="p">)</span>
<span class="c1"># The same layer applied twice.</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">FProp</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
<span class="k">return</span> <span class="n">a2</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>*args</strong> – List args.</li>
<li><strong>**kwargs</strong> – Keyward args.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.DropoutLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">DropoutLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#DropoutLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.DropoutLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Apply dropout during trainig.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.DropoutLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#DropoutLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.DropoutLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.DropoutLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#DropoutLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.DropoutLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply dropout to inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">inputs with dropout applied at training time.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.DeterministicDropoutLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">DeterministicDropoutLayer</code><span class="sig-paren">(</span><em>params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#DeterministicDropoutLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.DeterministicDropoutLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Apply dropout during trainig.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.DeterministicDropoutLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#DeterministicDropoutLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.DeterministicDropoutLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.DeterministicDropoutLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#DeterministicDropoutLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.DeterministicDropoutLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply dropout to inputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">inputs with dropout applied at training time.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.LayerNorm">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">LayerNorm</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#LayerNorm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.LayerNorm" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Layer normalization.</p>
<p>Implements layer normalization:
<a class="reference external" href="https://arxiv.org/abs/1607.06450">https://arxiv.org/abs/1607.06450</a></p>
<dl class="classmethod">
<dt id="lingvo.core.layers.LayerNorm.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#LayerNorm.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.LayerNorm.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.LayerNorm.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#LayerNorm.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.LayerNorm.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies normalization over the last dimension (layer).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – A tensor of shape […, hidden_dim].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">tensor of the same shape with inputs</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.ConvSetLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">ConvSetLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvSetLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvSetLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Set of Convolutions with different filter sizes in a single layer.</p>
<p>Applies a set of convolutions with different filter shapes to the inputs and
returns the concatenated outputs.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.ConvSetLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvSetLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvSetLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.ConvSetLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em>, <em>paddings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#ConvSetLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.ConvSetLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply all convolution sets to inputs and concatenate outputs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – The inputs tensor. It is expected to be of shape [batch, time,
frequency, channel]. The time dimension corresponds to the height
dimension as in images and the frequency dimension corresponds to the
width dimension as in images.</li>
<li><strong>paddings</strong> – The paddings tensor. It is expected to be of shape [batch,
time].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>A tuple (out, output_paddings).</p>
<ul class="simple">
<li>out: output tensor. Expected to be of shape [batch, time_mod,
frequency_mod, out_channel_1 + out_channel_2 …] where time_mod and
frequency_mod depend on the conv layer strides and out_channel_i is
the output channel size of the i-th conv layer in the set.</li>
<li>output_paddings: Modified paddings tensor generated using
<a class="reference internal" href="#lingvo.core.layers._ComputeOutputPadding" title="lingvo.core.layers._ComputeOutputPadding"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_ComputeOutputPadding</span></code></a> within <a class="reference internal" href="#lingvo.core.layers.ConvLayer.FProp" title="lingvo.core.layers.ConvLayer.FProp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConvLayer.FProp</span></code></a>. Expected to be of the
shape [batch, time_mod].</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.LocalizedLabelSmoother">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">LocalizedLabelSmoother</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#LocalizedLabelSmoother"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.LocalizedLabelSmoother" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Smooths labels given as class ids.</p>
<p>Implements the smoothing from <a class="reference external" href="https://arxiv.org/abs/1612.02695">https://arxiv.org/abs/1612.02695</a>. Instead of
1-hot class ids the model is trained to predict a distribution over classes
that includes the correct class label and with a small probability the labels
of tokens that appear nearby in time in the ground truth. This typically acts
as a strong regularizer.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.LocalizedLabelSmoother.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#LocalizedLabelSmoother.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.LocalizedLabelSmoother.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.LocalizedLabelSmoother.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>target_paddings</em>, <em>target_labels</em>, <em>target_ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#LocalizedLabelSmoother.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.LocalizedLabelSmoother.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert class_ids to 1hot and smooth by neighborhood.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>target_paddings</strong> – float32 matrix [bs, seq_len]</li>
<li><strong>target_labels</strong> – int32 matrix [bs, seq_len]. This stores the target
label output at each decoder step as generated by the speech input
generator input_batch.tgt.labels</li>
<li><strong>target_ids</strong> – int32 matrix [bs, seq_len]. This stores the
target_id that is fed to the decoder, as generated by the speech input
generator input_batch.tgt.ids</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A tensor [bs, seq_len, num_classes] denoting a smoothed distribution over
num_classes.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.UniformLabelSmoother">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">UniformLabelSmoother</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#UniformLabelSmoother"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.UniformLabelSmoother" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Smooths labels given as class ids and confidence.</p>
<p>Implements the smoothing from <a class="reference external" href="https://arxiv.org/abs/1512.00567">https://arxiv.org/abs/1512.00567</a>. Correct class
label confidence is dropped by eps and all the other classes are increased
by eps/num_classes.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.UniformLabelSmoother.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#UniformLabelSmoother.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.UniformLabelSmoother.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.UniformLabelSmoother.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>target_paddings</em>, <em>target_labels</em>, <em>target_ids</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#UniformLabelSmoother.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.UniformLabelSmoother.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert target_labels to 1hot and smooth uniformly.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>target_paddings</strong> – float32 matrix [bs, seq_len]</li>
<li><strong>target_labels</strong> – int32 matrix [bs, seq_len]. This stores the target
label output at each decoder step as generated by the speech input
generator input_batch.tgt.labels</li>
<li><strong>target_ids</strong> – int32 matrix [bs, seq_len]. This stores the
target_id that is fed to the decoder, as generated by the speech input
generator input_batch.tgt.ids</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A tensor of float32 [bs, seq_len, num_classes] denoting a smoothed
distribution over num_classes.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.HighwaySkipLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">HighwaySkipLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#HighwaySkipLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.HighwaySkipLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>A highway skip layer.</p>
<p>This class represents a highway skip layer, which takes multiple
inputs (from different layers of the network) and gates them.
This returns C(x)x + T(x)h, initially biasing C to be open.
For some discussion about initialization please see:
Section 2.2 in [Srivastava, 2015]: <a class="reference external" href="https://arxiv.org/pdf/1505.00387v2.pdf">https://arxiv.org/pdf/1505.00387v2.pdf</a></p>
<dl class="classmethod">
<dt id="lingvo.core.layers.HighwaySkipLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#HighwaySkipLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.HighwaySkipLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.HighwaySkipLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>x</em>, <em>transformed_x</em>, <em>paddings=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#HighwaySkipLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.HighwaySkipLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Fprop for Highway Skip layer.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>x</strong> – feature at the lower layer.</li>
<li><strong>transformed_x</strong> – transformation of x at a higher layer.</li>
<li><strong>paddings</strong> – padding applied to the features.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">layer_out - activations after forward propagation.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.GradNormTracker">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">GradNormTracker</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#GradNormTracker"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.GradNormTracker" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>A helper class to keep track of gradient norm stats.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.GradNormTracker.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#GradNormTracker.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.GradNormTracker.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.GradNormTracker.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>grad_norm</em>, <em>has_nan=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#GradNormTracker.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.GradNormTracker.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Update gradient norm moving avgs, and returns whether or not …</p>
<p>to clip gradients to 0.0. If the current batch has NaN grads, does not
update the moving avgs and forces to clip the gradients to 0.0.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>grad_norm</strong> – A float scalar tensor.</li>
<li><strong>has_nan</strong> – A boolean scalar tensor to indicate if the current batch has nan.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A scalar float tensor with value of either 1.0 or 0.0. The value of 0.0
means the gradient norm is excessively large or contains NaN, and the step
should be aborted completely.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.layers.WeightedSumLayer">
<em class="property">class </em><code class="descclassname">lingvo.core.layers.</code><code class="descname">WeightedSumLayer</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#WeightedSumLayer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.WeightedSumLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.LayerBase" title="lingvo.core.base_layer.LayerBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.LayerBase</span></code></a></p>
<p>Returns the weighted sum of a list of input tensors.</p>
<dl class="classmethod">
<dt id="lingvo.core.layers.WeightedSumLayer.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#WeightedSumLayer.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.WeightedSumLayer.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Params for this MergerLayer class.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.layers.WeightedSumLayer.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/layers.html#WeightedSumLayer.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.layers.WeightedSumLayer.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Combines the list of input tensors into a single tensor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this
layer and its children layers.</li>
<li><strong>inputs</strong> – A list of tensors of shape [time, batch, hidden_dim]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A tensor of the same shape with input tensors.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.core.layers_with_attention.html" class="btn btn-neutral float-right" title="lingvo.core.layers_with_attention module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.input_generator_helper.html" class="btn btn-neutral" title="lingvo.core.input_generator_helper module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>